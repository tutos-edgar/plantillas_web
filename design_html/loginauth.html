<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login con Google</title>
    <script src="https://apis.google.com/js/api.js"></script>
</head>

<body>
    <h2>Inicia sesión para acceder al contenido</h2>
    <button id="loginButton">Iniciar sesión con Google</button>
    <p id="status"></p>

    <script>
        const CLIENT_ID = 'TU_CLIENT_ID'; // Reemplaza con tu Client ID
        const API_KEY = 'TU_API_KEY'; // Reemplaza con tu API Key
        const CHANNEL_ID = 'TU_CANAL_ID'; // Reemplaza con tu canal

        // Cargar librería Google API
        function handleClientLoad() {
            gapi.load('client:auth2', initClient);
        }

        // Inicializar cliente
        function initClient() {
            gapi.client.init({
                apiKey: API_KEY,
                clientId: CLIENT_ID,
                discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest"],
                scope: "https://www.googleapis.com/auth/youtube.readonly"
            }).then(() => {
                const loginBtn = document.getElementById('loginButton');
                loginBtn.onclick = () => {
                    gapi.auth2.getAuthInstance().signIn().then(userLoggedIn);
                };
            });
        }

        // Usuario logueado
        function userLoggedIn(googleUser) {
            const profile = googleUser.getBasicProfile();
            document.getElementById('status').textContent = `Hola ${profile.getName()}, verificando suscripción...`;

            checkSubscription();
        }

        // Verificar suscripción al canal
        function checkSubscription() {
            gapi.client.youtube.subscriptions.list({
                part: 'snippet',
                mine: true,
                maxResults: 50
            }).then(response => {
                const subscriptions = response.result.items;
                const isSubscribed = subscriptions.some(sub => sub.snippet.resourceId.channelId === CHANNEL_ID);
                if (isSubscribed) {
                    document.getElementById('status').textContent += " ¡Estás suscrito a mi canal!";
                } else {
                    document.getElementById('status').textContent += " No estás suscrito a mi canal.";
                }

                // Enviar info al servidor con PHP (opcional)
                fetch('guardarUsuario.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        subscribed: isSubscribed,
                        name: profile.getName(),
                        email: profile.getEmail()
                    })
                });
            });
        }

        // Cargar API
        handleClientLoad();
    </script>
</body>

</html>